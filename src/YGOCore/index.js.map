{"version":3,"file":"index.js","sources":["../src/commands/BaseCommand.ts","../src/types/duel-events.ts","../src/types/types.ts","../src/commands/ActivateCardCommand.ts","../src/game/YGOGameUtils.ts","../src/game/YGOUtils.ts","../src/commands/MoveCardCommand.ts","../src/commands/BanishCommand.ts","../src/commands/DestroyCard.ts","../src/commands/DrawFromDeckCommand.ts","../src/commands/RevealCommand.ts","../src/commands/FieldSpellCommand.ts","../src/commands/SendCardToGY.ts","../src/commands/LinkSummonCommand.ts","../src/commands/MillFromDeckCommand.ts","../src/commands/NormalSummonCommand.ts","../src/commands/SetCardCommand.ts","../src/commands/SetMonsterCommand.ts","../src/commands/ShuffleDeck.ts","../src/commands/SpecialSummonCommand.ts","../src/commands/ToDeckCommand.ts","../src/commands/ToExtraDeckCommand.ts","../src/commands/ToHandCommand.ts","../src/commands/TributeSetCommand.ts","../src/commands/TributeSummonCommand.ts","../src/commands/XYZAttachMaterialCommand.ts","../src/commands/XYZDetachMaterialCommand.ts","../src/commands/XYZSummonCommand.ts","../src/commands/index.ts","../src/utils/event-bus.ts","../src/game/YGODuelLog.ts","../src/game/YGOGameState.ts","../src/game/YGOReplayUtils.ts","../src/game/YGOCore.ts","../src/index.ts"],"sourcesContent":["import { YGOCore } from \"../game/YGOCore\";\nimport { CommandType, Command } from \"../types/commands\";\n\nexport abstract class BaseCommand implements Command {\n\n    protected YGO!: YGOCore;\n    public type!: CommandType;\n    public commandId: number = -1;\n    public parent: Command | null = null;\n\n    constructor() { }\n\n    init(ygo: YGOCore) {\n        this.YGO = ygo;\n        this.commandId = this.YGO.getNextCommandId();\n    }\n\n    getCommandId() {\n        return this.parent?.commandId || this.commandId;\n    }\n\n    execChildCommand(command: Command): Command | undefined {\n        command.parent = this;\n        command.init(this.YGO);\n        command.exec();\n        return command;\n    }\n\n    undoChildCommand(command: Command | undefined): Command | undefined {\n        command?.undo();\n        return command;\n    }\n\n    undoMultipleChildCommand(commands: Command[]): void {\n        for (let i = commands.length - 1; i >= 0; --i) {\n            commands[i]?.undo();\n        }\n    }\n\n    execMultipleChildCommand(commands: Command[]): void {\n        for (const command of commands) {\n            this.execChildCommand(command);\n        }\n    }\n\n    isValid(): boolean {\n        return true;\n    }\n\n    exec(): void {\n\n    }\n\n    undo(): void {\n\n    }\n\n    toJSON<T extends any = any>(): { type: string, data: T } {\n        const self = this as any;\n        const data = self.data || {};\n        const type: string = (self?.constructor?.name || data.type || \"NO_TYPE\") as string;\n\n        return {\n            type,\n            data,\n        };\n    }\n}","import { CardPosition, FieldZone } from \"./types\";\n\nexport namespace YGODuelEvents {\n    export enum LogType {\n        NormalSummon = \"Normal Summon\",\n        SetMonster = \"Set Monster\",\n        SendToGY = \"Send To GY\",\n        Banish = \"Banish\",\n        BanishFD = \"Banish FD\",\n        DrawCardFromDeck = \"Draw From Deck\",\n        MillCardFromDeck = \"Mill From Deck\",\n        TributeSummon = \"Tribute Summon\",\n        TributeSet = \"Tribute Set\",\n        ToHand = \"To Hand\",\n        ToTopDeck = \"To Top Deck\",\n        ToBottomDeck = \"To Bottom Deck\",\n        SpecialSummon = \"Special Summon\",\n        FusionSummon = \"Fusion Summon\",\n        SynchroSummon = \"Synchro Summon\",\n        LinkSummon = \"Link Summon\",\n        XYZSummon = \"XYZ Summon\",\n        XYZAttachMaterial = \"XYZ Attach Material\",\n        XYZDetachMaterial = \"XYZ Detach Material\",\n        XYZOverlay = \"XYZOverlay\",\n        SetST = \"Set ST\",\n        Activate = \"Activate\",\n        ChangeBattlePosition = \"Change Battle Position\",\n        MoveCard = \"Move Card\",\n        Shuffle = \"Shuffle\",\n        ToST = \"To ST\",\n        Reveal = \"Reveal\",\n        Target = \"Target\",\n        FieldSpell = \"Field Spell\"\n    }\n\n    export interface DuelLog {\n        type: LogType;\n        player: number;\n        commandId: number;\n    }\n\n    export interface NormalSummon extends DuelLog {\n        id: number;\n        originZone: FieldZone;\n        zone: FieldZone;\n        position: CardPosition;\n    }\n\n    export interface MoveCard extends DuelLog {\n        id: number;\n        originZone: FieldZone;\n        zone: FieldZone;\n        position: CardPosition;\n    }\n\n    export interface ToHand extends MoveCard { }\n\n    export interface SetMonster extends DuelLog {\n        id: number;\n        originZone: FieldZone;\n        zone: FieldZone;\n    }\n\n    export interface SendToGY extends DuelLog {\n        id: number\n        originZone: FieldZone\n        zone: FieldZone,\n        reason?: \"Fusion Summon\" | \"Synchro Summon\" | \"Link Summon\" | \"XYZ Material\" | undefined\n    }\n\n    export interface DrawFromDeck extends DuelLog {\n        id: number,\n        zone: FieldZone\n    }\n\n    export interface FusionSummon extends DuelLog {\n        id: number\n        originZone: FieldZone\n        zone: FieldZone\n        position: CardPosition\n        materials: Array<{\n            id: number\n            zone: FieldZone\n        }>\n    }\n\n    export interface SynchroSummon extends DuelLog {\n        id: number\n        originZone: FieldZone\n        zone: FieldZone\n        position: CardPosition\n        materials: Array<{\n            id: number\n            zone: FieldZone\n        }>\n    }\n\n    export interface LinkSummon extends DuelLog {\n        id: number\n        originZone: FieldZone\n        zone: FieldZone\n        materials: Array<{\n            id: number\n            zone: FieldZone\n        }>\n    }\n\n    export interface XYZSummon extends DuelLog {\n        id: number\n        originZone: FieldZone\n        zone: FieldZone\n        position: CardPosition\n        materials: Array<{\n            id: number\n            zone: FieldZone\n        }>\n    }\n\n    export interface XYZAttach extends DuelLog {\n        id: number\n        originZone: FieldZone\n        overlayZone: FieldZone\n    }\n\n    export interface XYZOverlay extends DuelLog {\n        id: number\n        originZone: FieldZone\n        overlayZone: FieldZone\n    }\n\n    export interface XYZDetach extends DuelLog {\n        id: number\n        overlayZone: FieldZone\n        materialIndex: number\n    }\n\n    export interface Activate extends DuelLog {\n        id: number,\n        originZone?: FieldZone,\n        zone: FieldZone\n    }\n\n    export interface Banish extends DuelLog {\n        id: number;\n        originZone: FieldZone;\n        zone: FieldZone;\n        position: CardPosition;\n    }\n\n    export interface Shuffle extends DuelLog { }\n\n    export interface Reveal extends DuelLog {\n        id: number;\n        zone: FieldZone;\n    }\n\n    export interface Target extends DuelLog {\n        id: number;\n        zone: FieldZone;\n    }\n}\n\n","export const NUM_ZONES: number = 5; // Number of primary zones (Monster, Spell/Trap, etc.)\nexport type PlayerSide = 0 | 1 | number; // 0 represents Player 1, 1 represents Player 2\n\nexport type CardPosition = \"faceup-attack\" | \"faceup-defense\" | \"faceup\" | \"facedown\";\n\nexport type FieldZone = `M-${1 | 2 | 3 | 4 | 5}`\n    | `M2-${1 | 2 | 3 | 4 | 5}`\n    | `S-${1 | 2 | 3 | 4 | 5}`\n    | `S2-${1 | 2 | 3 | 4 | 5}`\n    | `EMZ`\n    | `EMZ2`\n    | `EMZ-${1 | 2}`\n    | `EMZ2-${1 | 2}`\n    | `ORU-${1 | 2 | 3 | 4 | 5}` // Overlay Units ORU Xyz Materials\n    | `ORU2-${1 | 2 | 3 | 4 | 5}`\n    | `ORUEMZ-${1 | 2}` // Xyz Materials in extra monster zone :)\n    | `ORUEMZ2-${1 | 2}`\n    | \"H\"\n    | \"H2\"\n    | `H-${number}`\n    | `H2-${number}`\n    | \"F\"\n    | \"F2\"\n    | \"GY\"\n    | \"GY2\"\n    | `GY-${number}`\n    | `GY2-${number}`\n    | \"B\"\n    | \"B2\"\n    | `B-${number}`\n    | `B2-${number}`\n    | \"D\"\n    | \"D2\"\n    | `D-${number}`\n    | `D2-${number}`\n    | \"ED\"\n    | \"ED2\"\n    | `ED-${number}`\n    | `ED2-${number}`;\n\nexport type FieldZoneId = \"M\" | \"S\" | \"EMZ\" | \"GY\" | \"D\" | \"ED\" | \"B\" | \"F\" | \"ORU\" | \"ORUEMZ\" | \"H\";\n\nexport type FieldZoneData = { zone: FieldZoneId, player: number, zoneIndex: number }\n\nexport enum CardBaseType {\n    NormalMonster,\n    EffectMonster,\n    RitualMonster,\n    Spell,\n    Trap,\n    FusionMonster,\n    SynchroMonster,\n    XYZMonster,\n    LinkMonster,\n}\n\nexport interface YGOProps {\n    players: {\n        name: string,\n        mainDeck: CardData[], // Card Data is the same as https://ygoprodeck.com/api-guide\n        extraDeck: CardData[] // Card Data is the same as https://ygoprodeck.com/api-guide\n        mainDeckOrder?: number[]\n    }[],\n    commands?: { type: string, data: any }[]\n    options?: {\n        lp?: number, // default `8000`\n        shuffleDecks?: boolean // default value is `true`,\n        fieldState?: FileldStateEntry[][] // default\n    }\n}\n\nexport interface FileldStateEntry {\n    id: number,\n    zone: FieldZone\n    atk?: number\n    def?: number\n    owner?: number\n    position?: CardPosition\n    materials?: Array<number>\n}\n\nexport interface CardData {\n    id: number\n    name: string\n    typeline: string[]\n    type: string\n    frameType: string\n    desc: string,\n    race: string,\n    atk: number\n    def: number\n    level: number\n    attribute: string\n    card_images: any\n}\n\nexport interface Card {\n    id: number\n    name: string\n    typeline: string[]\n    type: string\n    frameType: string\n    desc: string,\n    race: string,\n    atk: number\n    def: number\n    level: number\n    attribute: string\n    card_images: any\n    // game_data\n    index: number // internal unique ID\n    owner: number\n    isMainDeckCard: boolean\n    originalOwner: number\n    position: CardPosition\n    currentAtk: number\n    currentDef: number\n    materials: Card[]\n}\n\nexport interface PlayerInfo {\n    name: string;\n}\n\nexport interface PlayerField {\n    lp: number,\n    player: PlayerInfo\n    mainDeck: Card[]\n    extraDeck: Card[]\n    hand: Card[]\n    initialHandSize: number;\n    initialMainDeckOrder: number[];\n    graveyard: Card[]\n    banishedZone: Card[]\n    // Zones on the field where cards are actively played\n    monsterZone: Array<Card | null>\n    spellTrapZone: Array<Card | null>\n    fieldZone: Card | null;\n    extraMonsterZone: Array<Card | null>;\n}\n\nexport interface GameState {\n    players: PlayerInfo[];\n    fields: PlayerField[];\n}\n","import { BaseCommand } from './BaseCommand';\nimport { ActivateCardCommandData } from '../types/commands';\nimport { Card, CardPosition } from '../types/types';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class ActivateCardCommand extends BaseCommand {\n    private data: ActivateCardCommandData;\n    private prevPosition: CardPosition | undefined;\n\n    constructor(data: ActivateCardCommandData) {\n        super();\n        this.type = \"Activate\";\n        this.data = data;\n    }\n\n    override exec(): void {\n        const card = this.YGO.state.getCardById(this.data.id, this.data.originZone || this.data.zone)!;\n\n        if (this.data.originZone) {\n            this.YGO.state.removeCard(this.data.originZone);\n            this.YGO.state.setCard(card, this.data.zone);\n\n            console.log(`Exec: Activate ${this.data.id} from ${this.data.originZone} in ${this.data.zone}`);\n        } else {\n            console.log(`Exec: Activate ${this.data.id} in ${this.data.zone}`);\n        }\n\n        this.prevPosition = card.position;\n\n        if (card.type === \"Spell Card\" || card.type === \"Trap Card\") {\n            card.position = \"faceup\";\n        }\n\n        this.YGO.duelLog.dispatch<YGODuelEvents.Activate>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.Activate,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone\n        });\n    }\n\n    override undo(): void {\n        const card = this.YGO.state.getCardById(this.data.id, this.data.zone);\n\n        if (this.data.originZone) {\n            this.YGO.state.removeCard(this.data.originZone);\n            this.YGO.state.setCard(card, this.data.zone);\n\n            console.log(`Undo: Activate ${this.data.id} from ${this.data.originZone} in ${this.data.zone}`);\n        } else {\n            console.log(`Undo: Activate ${this.data.id} in ${this.data.zone}`);\n        }\n\n        if (this.prevPosition) {\n            card.position = this.prevPosition;\n        }\n    }\n}","import { Card, CardBaseType, FieldZone, FieldZoneId, FieldZoneData, PlayerField } from \"../types/types\";\n\n// Only functions for game utils\nexport class YGOGameUtils {\n\n    static isLinkMonster(card: Card): boolean {\n        return card.typeline?.includes(\"Link\");\n    }\n\n    static isXYZMonter(card: Card) {\n        return card.typeline?.includes(\"Xyz\");\n    }\n\n    static isPendulumCard(card: Card) {\n        return card.frameType?.includes(\"pendulum\");\n    }\n\n    static isFaceUp(card: Card): boolean {\n        return card.position.includes(\"faceup\");\n    }\n\n    static isFaceDown(card: Card): boolean {\n        return !this.isFaceUp(card);\n    }\n\n    static isSpellTrap(card: Card) {\n        return this.isSpell(card) || this.isTrap(card);\n    }\n\n    static isSpell(card: Card) {\n        return card.frameType.startsWith(\"spell\");\n    }\n\n    static isTrap(card: Card) {\n        return card.frameType.startsWith(\"spell\");\n    }\n\n    static isDefense(card: Card) {\n        return card.position === \"facedown\" || card.position === \"faceup-defense\";\n    }\n\n    static isAttack(card: Card) {\n        return card.position === \"faceup-attack\" || card.position === \"faceup\";\n    }\n\n    static hasLinkMonstersInField(field: PlayerField) {\n\n        if (field.monsterZone.some(card => card ? YGOGameUtils.isLinkMonster(card) : false)) {\n            return true;\n        }\n\n        return field.extraMonsterZone.some(card => card ? YGOGameUtils.isLinkMonster(card) : false);\n    }\n\n    static hasXyzMonstersInField(field: PlayerField) {\n\n        if (field.monsterZone.some(card => card ? YGOGameUtils.isXYZMonter(card) : false)) {\n            return true;\n        }\n\n        return field.extraMonsterZone.some(card => card ? YGOGameUtils.isXYZMonter(card) : false);\n    }\n\n    static getPlayerIndexFromZone(zone: string): number {\n        const isPlayer2 = zone.includes(\"2-\");\n\n        if (isPlayer2) return 1;\n\n        switch (zone) {\n            case \"M2\":\n            case \"H2\":\n            case \"F2\":\n            case \"GY2\":\n            case \"EMZ2-1\":\n            case \"EMZ2-2\":\n                return 1;\n            default:\n                return 0;\n        }\n    }\n\n    static createZone(zone: FieldZoneId, player: number, position?: number): FieldZone {\n\n        if (position === undefined) {\n            return `${zone}${player === 0 ? '' : '2'}` as FieldZone;\n        }\n\n        return `${zone}${player === 0 ? '' : '2'}-${position}` as FieldZone;\n    }\n\n    static getZoneData(zone: FieldZone): FieldZoneData {\n        const args = zone.split(\"-\");\n        let playerIndex = 0;\n        let zoneId = args[0];\n        const zoneIndex = args.length > 1 ? Number(args[1]) : -1;\n\n        if (args[0].endsWith(\"2\")) {\n            playerIndex = 1;\n            zoneId = zoneId.substring(0, zoneId.length - 1);\n        }\n\n        return {\n            zone: zoneId as FieldZoneId,\n            player: playerIndex,\n            zoneIndex: zoneIndex,\n        }\n    }\n\n    static getCardBaseType(card: Card): CardBaseType {\n        if (card.frameType.startsWith(\"effect\")) return CardBaseType.EffectMonster;\n        if (card.frameType.startsWith(\"spell\")) return CardBaseType.Spell;\n        if (card.frameType.startsWith(\"ritual\")) return CardBaseType.RitualMonster;\n        if (card.frameType.startsWith(\"trap\")) return CardBaseType.Trap;\n        if (card.frameType.includes(\"fusion\")) return CardBaseType.FusionMonster;\n        if (card.frameType.includes(\"synchro\")) return CardBaseType.SynchroMonster;\n        if (card.frameType.includes(\"xyz\")) return CardBaseType.XYZMonster;\n        if (card.frameType.includes(\"link\")) return CardBaseType.LinkMonster;\n        return CardBaseType.NormalMonster;\n    }\n\n    static getCardsBaseType(cards: Card[]): CardBaseType[] {\n        const result = cards.map(c => YGOGameUtils.getCardBaseType(c));\n        return result;\n    }\n\n    static toSortedCards(cards: Card[]) {\n        return this.sortCards([...cards]);\n    }\n\n    static sortCards(cardsToSort: Card[]) {\n        const cards = cardsToSort;\n        const cardsWeights = YGOGameUtils.getCardsBaseType(cards);\n\n        for (let i = 0; i < cards.length - 1; ++i) {\n            for (let j = 0; j < cards.length - i - 1; ++j) {\n                if (cardsWeights[j] > cardsWeights[j + 1] || (cardsWeights[j] === cardsWeights[j + 1] && cards[j].name > cards[j + 1].name)) {\n                    [cards[j], cards[j + 1]] = [cards[j + 1], cards[j]];\n                    [cardsWeights[j], cardsWeights[j + 1]] = [cardsWeights[j + 1], cardsWeights[j]];\n                }\n            }\n        }\n\n        return cards;\n    }\n\n    static shuffleCards(cards: Card[]): Array<number> {\n        const positions = Array<number>(cards.length);\n        for (let i = 0; i < cards.length; ++i) {\n            const index = Math.floor(Math.random() * cards.length);\n\n            positions[i] = index;\n\n            const temp = cards[i];\n            cards[i] = cards[index];\n            cards[index] = temp;\n        }\n        return positions;\n    }\n}","import { COMMANDS_BY_NAME } from \"../commands\";\nimport { Card, FieldZone, PlayerField, YGOProps } from \"../types/types\";\nimport { YGOCore } from \"./YGOCore\";\nimport { YGOGameUtils } from \"./YGOGameUtils\";\n\n// Only internal functions for game utils\nexport class YGOUtils {\n    static getPlayerIndexFromZone(zone: string): number {\n        return YGOGameUtils.getPlayerIndexFromZone(zone);\n    }\n\n    static parseMainDeck({ mainDeck, player }: { mainDeck: Card[], player: number }): Card[] {\n        return mainDeck.map(card => YGOUtils.parseCard({ card, player, isMainDeckCard: true }));\n    }\n\n    static parseExtraDeck({ extraDeck, player }: { extraDeck: Card[], player: number }): Card[] {\n        const extra = extraDeck.map(card => YGOUtils.parseCard({ card, player, isMainDeckCard: false }));\n        YGOGameUtils.sortCards(extra);\n        return extra;\n    }\n\n    static parseCard({ card, player, isMainDeckCard }: { card: Card, player: number, isMainDeckCard: boolean }): Card {\n        card.owner = player;\n        card.originalOwner = player;\n        card.materials = [];\n        card.isMainDeckCard = isMainDeckCard;\n        card.position = \"facedown\";\n        return card;\n    }\n\n    static getCardsInGame(fields: PlayerField[]): Map<number, Card> {\n        const cards = new Map<number, Card>()\n\n        for (const field of fields) {\n            for (const card of field.mainDeck) {\n                if (!cards.has(card.id)) {\n                    cards.set(card.id, card);\n                }\n            }\n\n            for (const card of field.extraDeck) {\n                if (!cards.has(card.id)) {\n                    cards.set(card.id, card);\n                }\n            }\n        }\n\n        return cards;\n    }\n\n    static getOverlayZone(zone: FieldZone): FieldZone {\n        const playerIndex = YGOUtils.getPlayerIndexFromZone(zone);\n        const zoneIndex = zone.split(\"-\")[1];\n\n        if (zone.startsWith(\"EMZ\")) {\n            return `ORU${playerIndex === 0 ? '' : '2'}-${zoneIndex}` as FieldZone;\n        }\n\n        return `ORUEMZ${playerIndex === 0 ? '' : '2'}-${zoneIndex}` as FieldZone;\n    }\n\n    static initializePlayersFields(props: YGOProps): [PlayerField, PlayerField] {\n        const { shuffleDecks = true } = props.options || {};\n        let cardIndex = 0;\n\n        const field1: PlayerField = {\n            lp: 8000,\n            player: { name: \"test\" },\n            mainDeck: [],\n            extraDeck: [],\n            hand: [],\n            initialHandSize: 5,\n            initialMainDeckOrder: [],\n            monsterZone: [null, null, null, null, null],\n            spellTrapZone: [null, null, null, null, null],\n            fieldZone: null,\n            extraMonsterZone: [null, null],\n            graveyard: [],\n            banishedZone: [],\n        };\n\n        const field2: PlayerField = {\n            lp: 8000,\n            player: { name: \"test2\" },\n            mainDeck: [],\n            extraDeck: [],\n            hand: [],\n            initialMainDeckOrder: [],\n            initialHandSize: 5,\n            monsterZone: [null, null, null, null, null],\n            spellTrapZone: [null, null, null, null, null],\n            fieldZone: null,\n            extraMonsterZone: [null, null],\n            graveyard: [],\n            banishedZone: [],\n        }\n\n        const fields: [PlayerField, PlayerField] = [field1, field2];\n\n        for (let playerIndex = 0; playerIndex < props.players.length; ++playerIndex) {\n            const player = props.players[playerIndex];\n            const field = fields[playerIndex];\n            field.initialMainDeckOrder = player.mainDeck.map((_, index) => index);\n            field.mainDeck = YGOUtils.parseMainDeck({ mainDeck: player.mainDeck as Card[], player: playerIndex });\n            field.extraDeck = YGOUtils.parseExtraDeck({ extraDeck: player.extraDeck as Card[], player: playerIndex });\n            field.mainDeck.forEach(card => card.index = ++cardIndex);\n            field.extraDeck.forEach(card => card.index = ++cardIndex);\n\n            if (player.mainDeckOrder) {\n                for (let i = 0; i < player.mainDeckOrder.length; ++i) {\n                    const swapIndex = player.mainDeckOrder[i];\n                    const temp = field.mainDeck[swapIndex];\n                    field.mainDeck[swapIndex] = field.mainDeck[i];\n                    field.mainDeck[i] = temp;\n                }\n            }\n        }\n\n        if (shuffleDecks) {\n            fields.forEach((field, playerIndex) => {\n                if (props.players[playerIndex]) {\n                    field.initialMainDeckOrder = props.players[playerIndex].mainDeckOrder || YGOGameUtils.shuffleCards(field.mainDeck)\n                }\n            });\n        }\n\n        return fields;\n    }\n\n    static getFieldsAsString(ygo: YGOCore) {\n        const log = [];\n\n        log.push(\"---- FIELD STATE ----\");\n\n        const field1 = ygo.getField(0);\n        const field2 = ygo.getField(1);\n\n        log.push(\"Player2: \" + field1.player.name);\n        log.push(\"Hand: \" + field2.hand.map(c => c.name).join(\" | \"));\n        log.push(\"Spell/Trap Zone: \" + field2.spellTrapZone.map(c => c?.name || \"_\").join(\" | \"));\n        log.push(\"Monster Zone: \" + field2.monsterZone.map(c => c?.name || \"_\").join(\" | \"));\n        log.push(\"-------\");\n        log.push(\"Extra Monster Zone: \" + ((field1.extraMonsterZone[0] || field2.extraMonsterZone[0])?.name || \"_\") + \" | \" + ((field1.extraMonsterZone[1] || field2.extraMonsterZone[1])?.name || \"_\"));\n        log.push(\"-------\");\n        log.push(\"Monster Zone: \" + field1.monsterZone.map(c => c?.name || \"_\").join(\" | \"));\n        log.push(\"Spell/Trap Zone: \" + field1.spellTrapZone.map(c => c?.name || \"_\").join(\" | \"));\n        log.push(\"Hand: \" + field1.hand.map(c => c.name).join(\" | \"));\n        log.push(\"Player1: \" + field1.player.name);\n\n        return log.join(\"\\n\");\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { MoveCardCommandData } from '../types/commands';\nimport { Card, CardPosition, FieldZone } from '../types/types';\nimport { YGOUtils } from '../game/YGOUtils';\nimport { YGODuelEvents } from '../types/duel-events';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class MoveCardCommand extends BaseCommand {\n    public data: MoveCardCommandData;\n\n    private prevPosition!: CardPosition;\n    private materialsToGY: Card[];\n\n    constructor(data: MoveCardCommandData) {\n        super();\n        const type = data.type || \"Move Card\";\n        this.type = type;\n        this.data = data;\n        this.materialsToGY = [];\n        this.data.type = type;\n    }\n\n    override exec(): void {\n        console.log(`Exec: ${this.data.type} ${this.data.id} from: ${this.data.originZone} to: ${this.data.zone}`);\n        const { log = true } = this.data;\n        const card = this.YGO.state.getCardById(this.data.id, this.data.originZone);\n\n        if (this.data.zone === \"ED\" || this.data.zone === \"ED2\") {\n            this.data.position = YGOGameUtils.isPendulumCard(card) ? \"faceup\" : \"facedown\";\n        }\n\n        if (this.data.position) {\n            this.prevPosition = card.position;\n            card.position = this.data.position;\n        }\n\n        // XYZ send materials to GY if send card to Gy or banish\n        if (this.sendMaterialsToGy(card, this.data.zone)) {\n            const overlayZone = YGOUtils.getOverlayZone(this.data.originZone);\n            this.materialsToGY = card.materials;\n            card.materials.forEach(material => {\n                this.YGO.state.setCard(material, \"GY\");\n                this.YGO.duelLog.dispatch<YGODuelEvents.SendToGY>({\n                    player: this.data.player,\n                    commandId: this.getCommandId(),\n                    type: YGODuelEvents.LogType.SendToGY,\n                    id: material.id,\n                    originZone: overlayZone,\n                    zone: this.data.zone,\n                    reason: \"XYZ Material\"\n                });\n            });\n            card.materials = [];\n        }\n\n        // TODO IF PENDULUMN send cards to Extra Deck\n        this.YGO.state.moveCard(card, this.data.originZone, this.data.zone);\n\n        if (log) {\n            this.YGO.duelLog.dispatch<any>({\n                player: this.data.player,\n                commandId: this.getCommandId(),\n                type: this.type as any,\n                id: this.data.id,\n                originZone: this.data.originZone,\n                zone: this.data.zone,\n                position: card.position\n            });\n        }\n    }\n\n    override undo(): void {\n        console.log(`Undo: ${this.data.type} ${this.data.id} from: ${this.data.originZone} to: ${this.data.zone}`);\n\n        const card = this.YGO.state.getCardById(this.data.id, this.data.zone);\n\n        if (this.materialsToGY.length > 0) {\n            this.materialsToGY.forEach(() => {\n                this.YGO.state.setCard(null, \"GY\");\n            });\n            card.materials = this.materialsToGY;\n        }\n\n        if (this.prevPosition) {\n            card.position = this.prevPosition;\n        }\n\n        this.YGO.state.moveCard(card, this.data.zone, this.data.originZone);\n    }\n\n    private sendMaterialsToGy(card: Card, zone: FieldZone): boolean {\n        if (!card.materials || card.materials.length === 0) return false;\n        if (this.data.zone.startsWith(\"GY\")) return true;\n        if (this.data.zone === \"B\" || this.data.zone === \"B2\") return true;\n        if (this.data.zone.startsWith(\"B-\") || this.data.zone.startsWith(\"B2-\")) return true;\n        return false;\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { BanishCommandData, Command } from '../types/commands';\nimport { FieldZone } from '../types/types';\nimport { MoveCardCommand } from './MoveCardCommand';\n\nexport class BanishCommand extends BaseCommand {\n    private data: BanishCommandData;\n    private zone: FieldZone;\n    private banishCommand: Command;\n\n    constructor(data: BanishCommandData) {\n        super();\n        this.data = data;\n        this.data.position = this.data.position || \"faceup\"\n        this.type = this.data.position === \"faceup\" ? \"Banish\" : \"Banish FD\";\n        this.zone = `B${this.data.player === 0 ? \"\" : \"2\"}-1`;\n\n        this.banishCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            position: this.data.position,\n            zone: this.zone\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.banishCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.banishCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, DestroyCardCommandData, SendCardToGYCommandData } from '../types/commands';\nimport { FieldZone } from '../types/types';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class DestroyCardCommand extends BaseCommand {\n    private data: DestroyCardCommandData;\n    private zone: FieldZone;\n    private moveCardCommand: Command;\n\n    constructor(data: DestroyCardCommandData) {\n        super();\n\n        this.type = \"Destroy\";\n        this.data = data;\n        this.zone = data.zone || YGOGameUtils.createZone(\"GY\", this.data.player, 1);\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.zone\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { DrawFromDeckCommandData } from '../types/commands';\nimport { Card, FieldZone } from '../types/types';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class DrawFromDeckCommand extends BaseCommand {\n    private data: DrawFromDeckCommandData;\n    private cards: Card[];\n\n    constructor(data: DrawFromDeckCommandData) {\n        super();\n\n        this.type = \"Draw From Deck\";\n        this.data = data;\n        this.data.numberOfCards = this.data.numberOfCards || 1;\n        this.cards = [];\n    }\n\n    exec(): void {\n        console.log(`Exec: Draw ${this.data.numberOfCards} from Deck`);\n\n        this.cards = [];\n\n        const field = this.YGO.state.fields[this.data.player];\n\n        for (let i = 0; i < this.data.numberOfCards!; ++i) {\n            const card = field.mainDeck.pop()!;\n            console.log(\"DRAW\", card.name);\n            field.hand.push(card);\n            this.cards.push(card);\n            const zone = `H-${field.hand.length}` as FieldZone;\n\n            this.YGO.duelLog.dispatch<YGODuelEvents.DrawFromDeck>({\n                commandId: this.getCommandId(),\n                player: this.data.player,\n                type: YGODuelEvents.LogType.DrawCardFromDeck,\n                id: card.id,\n                zone\n            });\n        }\n    }\n\n    undo(): void {\n        console.log(`Undo: Draw ${this.data.numberOfCards} from Deck`);\n\n        const newCards = [...this.cards].reverse();\n        const field = this.YGO.state.fields[this.data.player];\n\n        console.log(\"CARD DRAW UNDO\");\n        console.log(newCards.map(c => c.name));\n        console.log(\"DECK 1>>\", field.mainDeck.length);\n        for (const card of newCards) {\n            const cardInHandIndex = field.hand.findIndex(c => c === card);\n            if (cardInHandIndex !== -1) {\n                field.hand.splice(cardInHandIndex, 1);\n            }\n        }\n        field.mainDeck.push(...newCards);\n\n        console.log(field.hand.map(c => c.name));\n        console.log(\"DECK 2>>\", field.mainDeck.length);\n    }\n}\n","import { BaseCommand } from './BaseCommand';\nimport { NormalSummonCommandData, RevealCommandData } from '../types/commands';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class RevealCommand extends BaseCommand {\n    private data: RevealCommandData;\n\n    constructor(data: NormalSummonCommandData) {\n        super();\n        this.type = \"Reveal\";\n        this.data = data;\n    }\n\n    override exec(): void {\n        this.YGO.duelLog.dispatch<YGODuelEvents.Reveal>({\n            type: YGODuelEvents.LogType.Reveal,\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            id: this.data.id,\n            zone: this.data.zone\n        })\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, FieldSpellCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { RevealCommand } from './RevealCommand';\n\nexport class FieldSpellCommand extends BaseCommand {\n    private data: FieldSpellCommandData;\n    private commands: Command[];\n\n    constructor(data: FieldSpellCommandData) {\n        super();\n\n        this.type = \"Field Spell\";\n        this.data = data;\n        this.data.position = data.position === \"facedown\" ? \"facedown\" : \"faceup\";\n        this.commands = [];\n        this.commands.push(new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position\n        }));\n\n        if (this.data.reveal) {\n            this.commands.push(new RevealCommand({\n                id: this.data.id,\n                originZone: this.data.zone,\n                player: this.data.player,\n                zone: this.data.zone\n            }))\n        }\n    }\n\n    override exec(): void {\n        this.execMultipleChildCommand(this.commands);\n    }\n\n    override undo(): void {\n        this.undoMultipleChildCommand(this.commands);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, SendCardToGYCommandData } from '../types/commands';\nimport { FieldZone } from '../types/types';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class SendCardToGYCommand extends BaseCommand {\n    private data: SendCardToGYCommandData;\n    private zone: FieldZone;\n    private moveCardCommand: Command;\n\n    constructor(data: SendCardToGYCommandData) {\n        super();\n\n        this.type = \"Send To GY\";\n        this.data = data;\n        this.zone = data.zone || YGOGameUtils.createZone(\"GY\", this.data.player, 1);\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.zone\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, LinkSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { SendCardToGYCommand } from './SendCardToGY';\nimport { YGODuelEvents } from '../types/duel-events';\nimport { CardPosition } from '../types/types';\n\nexport class LinkSummonCommand extends BaseCommand {\n    private data: LinkSummonCommandData;\n    private commands: Command[];\n    private position: CardPosition;\n\n    constructor(data: LinkSummonCommandData) {\n        super();\n        this.type = \"Link Summon\";\n        this.data = data;\n        this.position = \"faceup-attack\";\n        this.commands = [];\n\n        this.data.materials.forEach(material => {\n            this.commands.push(new SendCardToGYCommand({\n                player: this.data.player,\n                id: material.id,\n                originZone: material.zone,\n                reason: \"Link Summon\"\n            }));\n        });\n\n        this.commands.push(new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.position,\n            log: false\n        }));\n    }\n\n    override exec(): void {\n        this.execMultipleChildCommand(this.commands);\n\n        this.YGO.duelLog.dispatch<YGODuelEvents.LinkSummon>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.LinkSummon,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            materials: this.data.materials\n        });\n    }\n\n    override undo(): void {\n        this.undoMultipleChildCommand(this.commands);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, MillFromDeckCommandData } from '../types/commands';\nimport { SendCardToGYCommand } from './SendCardToGY';\nimport { YGOCore } from '../game/YGOCore';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class MillFromDeckCommand extends BaseCommand {\n    private data: MillFromDeckCommandData;\n    private commands: Command[];\n\n    constructor(data: MillFromDeckCommandData) {\n        super();\n\n        this.type = \"Mill From Deck\";\n        const { numberOfCards = 1 } = data;\n        this.data = data;\n        this.data.numberOfCards = Math.max(1, numberOfCards);\n        this.commands = [];\n    }\n\n    override init(ygo: YGOCore): void {\n        super.init(ygo);\n\n        const field = this.YGO.getField(this.data.player);\n        const numberOfCards = Math.min(this.data.numberOfCards!, field.mainDeck.length);\n        console.log(this.data);\n        console.log(\"number\", numberOfCards);\n\n        for (let i = 0; i < numberOfCards!; ++i) {\n            const cardIndex = field.mainDeck.length - 1 - i;\n            const card = field.mainDeck[cardIndex];\n\n            console.log(\"WILL MILL \", card.id)\n\n            this.commands.push(new SendCardToGYCommand({\n                id: card.id,\n                originZone: YGOGameUtils.createZone(\"D\", this.data.player, cardIndex + 1),\n                player: this.data.player\n            }))\n        }\n    }\n\n    exec(): void {\n        this.execMultipleChildCommand(this.commands);\n    }\n\n    undo(): void {\n        this.undoMultipleChildCommand(this.commands);\n    }\n}\n","import { BaseCommand } from './BaseCommand';\nimport { Command, NormalSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\n\nexport class NormalSummonCommand extends BaseCommand {\n    private data: NormalSummonCommandData;\n    private moveCardCommand: Command;\n\n    constructor(data: NormalSummonCommandData) {\n        super();\n        this.type = \"Normal Summon\";\n        this.data = data;\n        this.data.position = \"faceup-attack\";\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position\n        });\n    }\n\n    override exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    override undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, SetCardCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\n\nexport class SetCardCommand extends BaseCommand {\n    private data: SetCardCommandData;\n    private moveCardCommand: Command;\n\n    constructor(data: SetCardCommandData) {\n        super();\n        this.type = \"Set ST\";\n        this.data = data;\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: \"facedown\"\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, SetMonsterCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\n\nexport class SetMonsterCommand extends BaseCommand {\n    private data: SetMonsterCommandData;\n    private moveCardCommand: Command;\n\n    constructor(data: SetMonsterCommandData) {\n        super();\n        this.type = \"Set Monster\";\n        this.data = data;\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: \"facedown\"\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { ShuffleDeckCommandData } from '../types/commands';\nimport { YGODuelEvents } from '../types/duel-events';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class ShuffleDeckCommand extends BaseCommand {\n    private data: ShuffleDeckCommandData;\n    private cardPositions!: Array<number>;\n\n    constructor(data: ShuffleDeckCommandData) {\n        super();\n        this.data = data;\n        this.type = \"Shuffle Deck\";\n    }\n\n    exec(): void {\n        const mainDeck = this.YGO.state.fields[this.data.player].mainDeck;\n\n        if (this.cardPositions) {\n            for (let i = 0; i < this.cardPositions.length; ++i) {\n                const index = this.cardPositions[i];\n                const temp = mainDeck[index];\n                mainDeck[index] = mainDeck[i];\n                mainDeck[i] = temp;\n            }\n        } else {\n            this.cardPositions = YGOGameUtils.shuffleCards(mainDeck);\n        }\n\n        if (this.data.log !== false) {\n            this.YGO.duelLog.dispatch<YGODuelEvents.Shuffle>({\n                player: this.data.player,\n                commandId: this.getCommandId(),\n                type: YGODuelEvents.LogType.Shuffle\n            });\n        }\n    }\n\n    undo(): void {\n        const mainDeck = this.YGO.state.fields[this.data.player].mainDeck;\n        for (let i = 0; i < this.cardPositions.length; ++i) {\n            const index = this.cardPositions[i];\n            const temp = mainDeck[index];\n            mainDeck[index] = mainDeck[i];\n            mainDeck[i] = temp;\n        }\n    }\n}\n","import { BaseCommand } from './BaseCommand';\nimport { Command, SpecialSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\n\nexport class SpecialSummonCommand extends BaseCommand {\n    private data: SpecialSummonCommandData;\n    private moveCardCommand: Command;\n\n    constructor(data: SpecialSummonCommandData) {\n        super();\n        this.type = \"Special Summon\";\n        this.data = data;\n        this.data.position = this.data.position || 'faceup-attack';\n\n        if (this.data.position !== 'faceup-attack'\n            && this.data.position !== 'faceup-defense') {\n            this.data.position = 'faceup-attack';\n        }\n\n        console.log(this.data);\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: \"Special Summon\",\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position\n        });\n    }\n\n    exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, ToDeckCommandData } from '../types/commands';\nimport { FieldZone } from '../types/types';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { ShuffleDeckCommand } from './ShuffleDeck';\nimport { YGOCore } from '../game/YGOCore';\n\nexport class ToDeckCommand extends BaseCommand {\n    private data: ToDeckCommandData;\n    private zone!: FieldZone;\n    private commands!: Command[];\n\n    constructor(data: ToDeckCommandData) {\n        super();\n        this.data = data;\n        this.type = this.getCommandType();\n    }\n\n    private isTopCard() {\n        return this.data.position === \"top\";\n    }\n\n    private getCommandType() {\n        return this.isTopCard() ? \"To Top Deck\" : \"To Bottom Deck\";\n    }\n\n    private getDeckIndex(): number {\n        const mainDeck = this.YGO.state.fields[0].mainDeck;\n\n        if (this.isTopCard()) {\n            return mainDeck.length + 1;\n        }\n\n        return 1;\n    }\n\n    override init(ygo: YGOCore): void {\n        super.init(ygo);\n\n        if (!this.commands) {\n            const deckIndex = this.getDeckIndex();\n            this.zone = `D${this.data.player === 0 ? \"\" : \"2\"}-${deckIndex}`;\n            this.commands = [];\n            this.commands.push(new MoveCardCommand({\n                player: this.data.player,\n                type: this.type,\n                id: this.data.id,\n                originZone: this.data.originZone,\n                zone: this.zone,\n                //position: \"facedown\", // TODO DECIDE\n            }));\n\n            const { shuffle = false } = this.data;\n\n            if (shuffle) {\n                this.commands.push(new ShuffleDeckCommand({ player: this.data.player }));\n            }\n        }\n    }\n\n    exec(): void {\n        this.execMultipleChildCommand(this.commands);\n    }\n\n    undo(): void {\n        this.undoMultipleChildCommand(this.commands);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, ToExtraDeckCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class ToExtraDeckCommand extends BaseCommand {\n    private data: ToExtraDeckCommandData;\n    private moveCardCommand: Command;\n\n    constructor(data: ToExtraDeckCommandData) {\n        super();\n        this.type = \"Normal Summon\";\n        this.data = data;\n\n        this.moveCardCommand = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: YGOGameUtils.createZone(\"ED\", this.data.player)\n        });\n    }\n\n    override exec(): void {\n        this.execChildCommand(this.moveCardCommand);\n    }\n\n    override undo(): void {\n        this.undoChildCommand(this.moveCardCommand);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, ToHandCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { YGOCore } from '../game/YGOCore';\nimport { YGOGameUtils } from '../game/YGOGameUtils';\n\nexport class ToHandCommand extends BaseCommand {\n    private data: ToHandCommandData;\n    private command!: Command;\n\n    constructor(data: ToHandCommandData) {\n        super();\n        this.type = \"To Hand\";\n        this.data = data;\n    }\n\n    override init(ygo: YGOCore): void {\n        super.init(ygo);\n\n        const handIndex = this.YGO.getField(this.data.player).hand.length + 1;\n\n        this.command = new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: YGOGameUtils.createZone(\"H\", this.data.player, handIndex),\n            position: \"facedown\"\n        });\n    }\n\n    override exec(): void {\n        this.execChildCommand(this.command);\n    }\n\n    override undo(): void {\n        this.undoChildCommand(this.command);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, TributeSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { SendCardToGYCommand } from './SendCardToGY';\n\nexport class TributeSetCommand extends BaseCommand {\n    private data: TributeSummonCommandData;\n    private commands: Command[];\n\n    constructor(data: TributeSummonCommandData) {\n        super();\n\n        this.type = \"Tribute Set\";\n        this.data = data;\n        this.data.position = \"facedown\";\n\n        this.commands = [];\n\n        this.data.tributes.forEach(card => {\n            this.commands.push(new SendCardToGYCommand({\n                id: card.id,\n                originZone: card.zone,\n                player: this.data.player\n            }));\n        });\n\n        this.commands.push(new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position\n        }));\n    }\n\n    exec(): void {\n        this.commands.forEach(cmd => this.execChildCommand(cmd));\n    }\n\n    undo(): void {\n        this.commands.forEach(cmd => this.undoChildCommand(cmd));\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, TributeSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { SendCardToGYCommand } from './SendCardToGY';\n\nexport class TributeSummonCommand extends BaseCommand {\n    private data: TributeSummonCommandData;\n    private commands: Command[];\n    \n    constructor(data: TributeSummonCommandData) {\n        super();\n        this.type = \"Tribute Summon\";\n        this.data = data;\n        this.data.position = this.data.position || \"faceup-attack\";\n        this.commands = [];\n\n        this.data.tributes.forEach(card => {\n            this.commands.push(new SendCardToGYCommand({\n                id: card.id,\n                originZone: card.zone,\n                player: this.data.player\n            }))\n        });\n\n        this.commands.push(new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position\n        }));\n    }\n\n    exec(): void {\n        this.commands.forEach(cmd => this.execChildCommand(cmd));\n    }\n\n    undo(): void {\n        this.commands.forEach(cmd => this.undoChildCommand(cmd));\n    }\n}\n","import { BaseCommand } from './BaseCommand';\nimport { XYZAttachCommandData as XYZAttachMaterialCommandData } from '../types/commands';\nimport { YGOUtils } from '../game/YGOUtils';\nimport { Card } from '../types/types';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class XYZAttachMaterialCommand extends BaseCommand {\n    private data: XYZAttachMaterialCommandData;\n    private materialCardReference!: Card;\n\n    constructor(data: XYZAttachMaterialCommandData) {\n        super();\n        this.type = \"XYZ Attach Material\";\n        this.data = data;\n    }\n\n    override exec(): void {\n        const card = this.YGO.state.getCardFromZone(this.data.zone)!;\n        this.materialCardReference = this.YGO.state.getCardById(this.data.id, this.data.originZone);\n        this.YGO.state.setCard(null, this.data.originZone);\n        card.materials.push(this.materialCardReference);\n\n        console.log(\"TCL:: EXEC ATTACH:: \", this.materialCardReference.name, this.data.originZone);\n\n        const overlayZone = YGOUtils.getOverlayZone(this.data.zone);\n\n        this.YGO.duelLog.dispatch<YGODuelEvents.XYZAttach>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.XYZSummon,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            overlayZone: overlayZone\n        });\n    }\n\n    override undo(): void {\n        const card = this.YGO.state.getCardFromZone(this.data.zone)!;\n        this.YGO.state.setCard(this.materialCardReference, this.data.originZone);\n        card.materials.splice(card.materials.indexOf(this.materialCardReference), 1);\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { XYZDetachCommandData } from '../types/commands';\nimport { YGOUtils } from '../game/YGOUtils';\nimport { Card } from '../types/types';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class XYZDetachMaterialCommand extends BaseCommand {\n    private data: XYZDetachCommandData;\n    private materialCardReference!: Card;\n\n    constructor(data: XYZDetachCommandData) {\n        super();\n        this.type = \"XYZ Detach Material\";\n        this.data = data;\n    }\n\n    override exec(): void {\n        const card = this.YGO.state.getCardFromZone(this.data.zone)!;\n        this.materialCardReference = card.materials[this.data.materialIndex];\n        card.materials.splice(this.data.materialIndex, 1);\n\n        this.YGO.state.setCard(this.materialCardReference, \"GY\");\n\n        const overlayZone = YGOUtils.getOverlayZone(this.data.zone);\n\n        this.YGO.duelLog.dispatch<YGODuelEvents.XYZDetach>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.XYZDetachMaterial,\n            id: card.id,\n            materialIndex: this.data.materialIndex,\n            overlayZone: overlayZone\n        });\n    }\n\n    override undo(): void {\n        const card = this.YGO.state.getCardFromZone(this.data.zone)!;\n        card.materials.splice(card.materials.indexOf(this.materialCardReference), 1);\n        this.YGO.state.setCard(null, \"GY\");\n    }\n}","import { BaseCommand } from './BaseCommand';\nimport { Command, XYZSummonCommandData } from '../types/commands';\nimport { MoveCardCommand } from './MoveCardCommand';\nimport { Card, FieldZone } from '../types/types';\nimport { YGOUtils } from '../game/YGOUtils';\nimport { YGODuelEvents } from '../types/duel-events';\n\nexport class XYZSummonCommand extends BaseCommand {\n    private data: XYZSummonCommandData;\n    private commands: Command[];\n    private overlayZone: FieldZone;\n\n    constructor(data: XYZSummonCommandData) {\n        super();\n        this.type = \"XYZ Summon\";\n        this.data = data;\n        this.data.position = this.data.position || \"faceup-attack\";\n        this.commands = [];\n        this.overlayZone = YGOUtils.getOverlayZone(this.data.zone);\n\n        this.data.materials.forEach(material => {\n            this.commands.push(new XYZMaterialsMove({\n                player: this.data.player,\n                overlayZone: this.overlayZone,\n                id: material.id,\n                zone: material.zone\n            }));\n        });\n\n        this.commands.push(new MoveCardCommand({\n            player: this.data.player,\n            type: this.type,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position,\n            log: false\n        }));\n    }\n\n    override exec(): void {\n        const card = this.YGO.state.getCardById(this.data.id, this.data.originZone);\n\n        // TODO: @RMS MATERIALS OF MATERIAL ex: nerd to zeus purrely to noir\n\n        card.materials = this.data.materials.map(material => {\n            const materialCard = this.YGO.state.getCardById(material.id, material.zone);\n            return materialCard;\n        });\n\n        this.execMultipleChildCommand(this.commands);\n        \n        this.YGO.duelLog.dispatch<YGODuelEvents.XYZSummon>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.XYZDetachMaterial,\n            id: this.data.id,\n            originZone: this.data.originZone,\n            zone: this.data.zone,\n            position: this.data.position!,\n            materials: this.data.materials\n        });\n    }\n\n    override undo(): void {\n        const card = this.YGO.state.getCardById(this.data.id, this.data.zone);\n        card.materials = [];\n        this.undoMultipleChildCommand(this.commands);\n    }\n}\n\ninterface XYZMaterialsMoveData {\n    player: number,\n    id: number\n    overlayZone: FieldZone\n    zone: FieldZone\n}\n\nclass XYZMaterialsMove extends BaseCommand {\n    private data: XYZMaterialsMoveData;\n    private card!: Card;\n\n    constructor(data: XYZMaterialsMoveData) {\n        super();\n        this.data = data;\n    }\n\n    exec(): void {\n        this.card = this.YGO.state.getCardById(this.data.id, this.data.zone);\n        this.YGO.state.setCard(null, this.data.zone);\n\n        this.YGO.duelLog.dispatch<YGODuelEvents.XYZOverlay>({\n            player: this.data.player,\n            commandId: this.getCommandId(),\n            type: YGODuelEvents.LogType.XYZOverlay,\n            id: this.data.id,\n            originZone: this.data.zone,\n            overlayZone: this.data.overlayZone\n        });\n    }\n\n    undo(): void {\n        this.YGO.state.setCard(this.card, this.data.zone);\n    }\n}\n","import { Command } from \"../types/commands\";\nimport { ActivateCardCommand } from \"./ActivateCardCommand\";\nimport { BanishCommand } from \"./BanishCommand\";\nimport { DestroyCardCommand } from \"./DestroyCard\";\nimport { DrawFromDeckCommand } from \"./DrawFromDeckCommand\";\nimport { FieldSpellCommand } from \"./FieldSpellCommand\";\nimport { LinkSummonCommand } from \"./LinkSummonCommand\";\nimport { MillFromDeckCommand } from \"./MillFromDeckCommand\";\nimport { NormalSummonCommand } from \"./NormalSummonCommand\";\nimport { RevealCommand } from \"./RevealCommand\";\nimport { SendCardToGYCommand } from \"./SendCardToGY\";\nimport { SetCardCommand } from \"./SetCardCommand\";\nimport { SetMonsterCommand } from \"./SetMonsterCommand\";\nimport { ShuffleDeckCommand } from \"./ShuffleDeck\";\nimport { SpecialSummonCommand } from \"./SpecialSummonCommand\";\nimport { ToDeckCommand } from \"./ToDeckCommand\";\nimport { ToExtraDeckCommand } from \"./ToExtraDeckCommand\";\nimport { ToHandCommand } from \"./ToHandCommand\";\nimport { TributeSetCommand } from \"./TributeSetCommand\";\nimport { TributeSummonCommand } from \"./TributeSummonCommand\";\nimport { XYZAttachMaterialCommand } from \"./XYZAttachMaterialCommand\";\nimport { XYZDetachMaterialCommand } from \"./XYZDetachMaterialCommand\";\nimport { XYZSummonCommand } from \"./XYZSummonCommand\";\n\nexport const Commands = {\n    NormalSummonCommand,\n    SetMonsterCommand,\n    SetCardCommand,\n    SendCardToGYCommand,\n    BanishCommand,\n    DrawFromDeckCommand,\n    MillFromDeckCommand,\n    ActivateCardCommand,\n    SpecialSummonCommand,\n    TributeSummonCommand,\n    TributeSetCommand,\n    LinkSummonCommand,\n    XYZSummonCommand,\n    XYZAttachMaterialCommand,\n    XYZDetachMaterialCommand,\n    ToDeckCommand,\n    ShuffleDeckCommand,\n    DestroyCardCommand,\n    RevealCommand,\n    ToExtraDeckCommand,\n    ToHandCommand,\n    FieldSpellCommand,\n}\n\nexport const COMMANDS_BY_NAME: any = {\n    \"NormalSummonCommand\": NormalSummonCommand,\n    \"SetMonsterCommand\": SetMonsterCommand,\n    \"SetCardCommand\": SetCardCommand,\n    \"SendCardToGYCommand\": SendCardToGYCommand,\n    \"BanishCommand\": BanishCommand,\n    \"DrawFromDeckCommand\": DrawFromDeckCommand,\n    \"MillFromDeckCommand\": MillFromDeckCommand,\n    \"ActivateCardCommand\": ActivateCardCommand,\n    \"SpecialSummonCommand\": SpecialSummonCommand,\n    \"TributeSummonCommand\": TributeSummonCommand,\n    \"TributeSetCommand\": TributeSetCommand,\n    \"LinkSummonCommand\": LinkSummonCommand,\n    \"XYZSummonCommand\": XYZSummonCommand,\n    \"XYZAttachMaterialCommand\": XYZAttachMaterialCommand,\n    \"XYZDetachMaterialCommand\": XYZDetachMaterialCommand,\n    \"ToDeckCommand\": ToDeckCommand,\n    \"ShuffleDeckCommand\": ShuffleDeckCommand,\n    \"DestroyCardCommand\": DestroyCardCommand,\n    \"RevealCommand\": RevealCommand,\n    \"ToExtraDeckCommand\": ToExtraDeckCommand,\n    \"ToHandCommand\": ToHandCommand,\n    \"FieldSpellCommand\": FieldSpellCommand\n}\n\nexport function GetCommandByClassName<T = Command>(commandClassName: string): T | null {\n    return COMMANDS_BY_NAME[commandClassName];\n}","export class EventBus<T extends Record<string, (...args: any[]) => void>> {\n    private events: Map<keyof T, Function[]>;\n\n    constructor() {\n        this.events = new Map();\n    }\n\n    on<K extends keyof T>(event: K, listener: T[K]): void {\n        if (!this.events.has(event)) {\n            this.events.set(event, []);\n        }\n        this.events.get(event)!.push(listener);\n    }\n\n    dispatch<K extends keyof T>(event: K, ...args: Parameters<T[K]>): void {\n        const listeners = this.events.get(event);\n        if (listeners) {\n            listeners.forEach(listener => listener(...args));\n        }\n    }\n\n    off<K extends keyof T>(event: K, listener: T[K]): void {\n        const listeners = this.events.get(event);\n        if (listeners) {\n            this.events.set(\n                event,\n                listeners.filter(l => l !== listener)\n            );\n        }\n    }\n\n    clear<K extends keyof T>(event: K): void {\n        if (this.events.has(event)) {\n            this.events.delete(event);\n        }\n    }\n\n    clearAll(): void {\n        this.events.clear();\n    }\n}","import { Command } from \"../types/commands\";\nimport { EventBus } from \"../utils/event-bus\";\nimport { YGODuelEvents } from '../types/duel-events';\n\ntype YGODuelLogEventMap = {\n    'new-log': (log: YGODuelEvents.DuelLog) => void;\n    'update-logs': (logs: YGODuelEvents.DuelLog[]) => void;\n};\n\nexport class YGODuelLog {\n    public logs: YGODuelEvents.DuelLog[];\n    public events: EventBus<YGODuelLogEventMap>;\n\n    constructor() {\n        this.logs = [];\n        this.events = new EventBus();\n    }\n\n    dispatch<T extends YGODuelEvents.DuelLog>(log: T) {\n        this.logs.push(log);\n        this.events.dispatch(\"new-log\", log);\n        this.onLogsUpdated();\n    }\n\n    peek(): YGODuelEvents.DuelLog | null {\n        if (this.logs.length == 0) return null;\n        return this.logs[this.logs.length - 1];\n    }\n\n    peekCommand(): number {\n        if (this.logs.length == 0) return -1;\n        return this.logs[this.logs.length - 1].commandId;\n    }\n\n    pop(): YGODuelEvents.DuelLog | null {\n        if (this.logs.length === 0) return null;\n        return this.logs.pop() as YGODuelEvents.DuelLog;\n    }\n\n    removeCommand(command: Command, args?: { log: boolean }) {\n        for (let i = this.logs.length - 1; i >= 0; --i) {\n            if (this.logs[i].commandId === command.commandId) {\n                this.logs.splice(i, 1);\n            } else {\n                break;\n            }\n        }\n\n        if (args?.log !== false) {\n            this.events.dispatch(\"update-logs\", this.logs);\n        }\n\n        // const lastCommand = this.peekCommand();\n\n        // if (lastCommand === command) {\n        //     this.entries.pop();\n\n        //     if (args?.log !== false) {\n        //         // this.events.dispatch(\"remove\", logEntry);\n        //         this.events.dispatch(\"logs-updated\", this.entries);\n        //     }\n        // }\n    }\n\n    onLogsUpdated() {\n        this.events.dispatch(\"update-logs\", this.logs);\n    }\n}","import { Card, FieldZone, FileldStateEntry, PlayerField, YGOProps } from \"../types/types\";\nimport { YGOGameUtils } from \"./YGOGameUtils\";\nimport { YGOUtils } from \"./YGOUtils\";\n\nexport class YGOGameState {\n    public fields: PlayerField[];\n    private cardsInGame: Map<number, Card>;\n\n    constructor(props: YGOProps) {\n        this.fields = YGOUtils.initializePlayersFields(props);\n        this.cardsInGame = YGOUtils.getCardsInGame(this.fields);\n    }\n\n    getCardById(id: number, zone: FieldZone): Card {\n        const playerIndex = zone.includes(\"2-\") ? 1 : 0;\n\n        if (zone === \"GY\" || zone === \"GY2\") {\n            const card = this.fields[playerIndex].graveyard.find(c => c.id === id);\n\n            if (!card) {\n                throw new Error(`card \"${id}\" not found in \"${zone}\"`);\n            }\n\n            return card;\n        }\n\n        const card = this.getCardFromZone(zone);\n\n        if (card && card.id === id) return card;\n\n        throw new Error(`card \"${id}\" not found in \"${zone}\"`);\n    }\n\n    getCardFromZone(zone: FieldZone): Card | null {\n        const playerIndex = zone.includes(\"2-\") ? 1 : 0;\n\n        if (zone.startsWith(\"H-\") || zone.startsWith(\"H2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].hand[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"M-\") || zone.startsWith(\"M2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].monsterZone[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"S-\") || zone.startsWith(\"S2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].spellTrapZone[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"GY-\") || zone.startsWith(\"GY2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].graveyard[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"B-\") || zone.startsWith(\"B2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].banishedZone[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"D-\") || zone.startsWith(\"D2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].mainDeck[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"ED-\") || zone.startsWith(\"ED2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].extraDeck[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"EMZ-\") || zone.startsWith(\"EMZ2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            const card = this.fields[playerIndex].extraMonsterZone[zoneIndex];\n            return card;\n        } else if (zone.startsWith(\"F\") || zone.startsWith(\"F2\")) {\n            const card = this.fields[playerIndex].fieldZone;\n            return card;\n        }\n\n        return null;\n    }\n\n    moveCardById(cardId: number, originZone: FieldZone, zone: FieldZone) {\n        const card = this.getCardById(cardId, originZone);\n        this.moveCard(card, originZone, zone);\n    }\n\n    moveCard(card: Card, originZone: FieldZone, zone: FieldZone) {\n        this.removeCard(originZone);\n        this.setCard(card, zone);\n    }\n\n    setCard(card: Card | null, zone: FieldZone): void {\n        const playerIndex = zone.includes(\"2-\") ? 1 : 0;\n\n        if (zone.startsWith(\"H-\") || zone.startsWith(\"H2-\") || zone === \"H\" || zone === \"H2\") {\n            const handIndex = zone.includes(\"-\") ? Number(zone.split(\"-\").pop()) - 1 : -1;\n            const hand = this.fields[playerIndex].hand;\n\n            if (handIndex == -1 && card) {\n                hand.push(card);\n            } else if (card) {\n                if (handIndex >= hand.length) {\n                    hand.push(card);\n                } else {\n                    hand.splice(handIndex, 0, card);\n                }\n            } else {\n                hand.splice(handIndex, 1);\n            }\n        } else if (zone.startsWith(\"M-\") || zone.startsWith(\"M2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            this.fields[playerIndex].monsterZone[zoneIndex] = card;\n            // todo check if monster etc \n        } else if (zone.startsWith(\"S-\") || zone.startsWith(\"S2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            this.fields[playerIndex].spellTrapZone[zoneIndex] = card;\n        } else if (zone.startsWith(\"EMZ-\") || zone.startsWith(\"EMZ2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n            this.fields[playerIndex].extraMonsterZone[zoneIndex] = card;\n        }\n        else if (zone.startsWith(\"ED\") || zone.startsWith(\"ED2\")) { // append to extra\n            if (zone.indexOf(\"-\") !== -1) {\n                const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n                if (!card) {\n                    this.fields[playerIndex].extraDeck.splice(zoneIndex, 1);\n                } else {\n                    this.fields[playerIndex].extraDeck.splice(zoneIndex, 0, card);\n                }\n            } else if (card) {\n                const isPendulum = card.isMainDeckCard && YGOGameUtils.isPendulumCard(card);\n                const extraDeck = this.fields[playerIndex].extraDeck;\n\n                if (isPendulum) {\n                    extraDeck.unshift(card); // add card to top of extraDeck\n                } else {\n                    const weight = YGOGameUtils.getCardBaseType(card);\n                    const index = extraDeck.findIndex(c => {\n                        const weight2 = YGOGameUtils.getCardBaseType(c);\n                        return weight < weight2 || (weight === weight2 && card.name < c.name);\n                    });\n\n                    if (index !== -1) {\n                        extraDeck.splice(index, 0, card);\n                    } else {\n                        extraDeck.push(card);\n                    }\n                }\n            } else {\n                throw new Error(\"No card to add to Extra Deck\");\n            }\n        } else if (zone.startsWith(\"D-\") || zone.startsWith(\"D2-\")) {\n            const zoneIndex = Number(zone.split(\"-\").pop()) - 1;\n\n            console.log(\"MOVE CARD TO DECK \", zone);\n\n            if (!card) {\n                this.fields[playerIndex].mainDeck.splice(zoneIndex, 1);\n            } else {\n                this.fields[playerIndex].mainDeck.splice(zoneIndex, 0, card);\n            }\n        } else if (zone === \"GY\" || zone === \"GY2\" || zone.startsWith(\"GY-\") || zone.startsWith(\"GY2-\")) {\n            const gyIndex = zone.includes(\"-\") ? Number(zone.split(\"-\").pop()) - 1 : -1;\n            const gy = this.fields[playerIndex].graveyard;\n\n            if (card) {\n                if (gyIndex === -1) {\n                    gy.unshift(card);\n                } else {\n                    gy.splice(gyIndex, 0, card);\n                }\n            } else {\n                if (gyIndex == -1) {\n                    gy.pop();\n                } else {\n                    gy.splice(gyIndex, 1);\n                }\n            }\n        } else if (zone === \"B\" || zone === \"B2\" || zone.startsWith(\"B-\") || zone.startsWith(\"B2-\")) {\n            const gyIndex = zone.includes(\"-\") ? Number(zone.split(\"-\").pop()) - 1 : -1;\n            const banishZone = this.fields[playerIndex].banishedZone;\n\n            if (card) {\n                if (gyIndex === -1) {\n                    banishZone.unshift(card);\n                } else {\n                    banishZone.splice(gyIndex, 0, card);\n                }\n            } else {\n                if (gyIndex == -1) {\n                    banishZone.pop();\n                } else {\n                    banishZone.splice(gyIndex, 1);\n                }\n            }\n        } else if (zone.startsWith(\"F\") || zone.startsWith(\"F2\")) {\n            this.fields[playerIndex].fieldZone = card;\n        }\n    }\n\n    removeCard(zone: FieldZone): Card | null {\n        const card = this.getCardFromZone(zone);\n        this.setCard(null, zone);\n        // TODO Reset card\n        return card;\n    }\n\n    getCardData(cardId: number): Card | null {\n        return this.cardsInGame.get(cardId) || null;\n    }\n\n    shuffleDeck(player: number) {\n        const deck = this.fields[player].mainDeck;\n        if (deck.length === 0) return; // If the deck is empty, do nothing\n\n        for (let i = deck.length - 1; i > 0; i--) {\n            const cardIndex = Math.floor(Math.random() * (i + 1));\n            [deck[i], deck[cardIndex]] = [deck[cardIndex], deck[i]];\n        }\n    }\n\n    getPlayerIndexFromZone(zone: string): number {\n        return YGOUtils.getPlayerIndexFromZone(zone);\n    }\n\n    getAvailableZones(fieldZones: (\"M\" | \"M2\" | \"S\" | \"S2\" | \"F\" | \"F2\" | \"EMZ\")[]): FieldZone[] {\n        const result: FieldZone[] = [];\n\n        // TODO @RMS  make this player aware\n\n        for (const fieldZone of fieldZones) {\n            const player = this.getPlayerIndexFromZone(fieldZone);\n            const field = this.fields[player];\n            if (fieldZone === \"M\") {\n                field.monsterZone.forEach((data, index) => {\n                    const zone = `M${player === 0 ? \"\" : \"2\"}-${index + 1}`;\n                    if (!data) result.push(zone as FieldZone);\n                });\n            } else if (fieldZone === \"S\") {\n                field.spellTrapZone.forEach((data, index) => {\n                    const zone = `S${player === 0 ? \"\" : \"2\"}-${index + 1}`;\n                    if (!data) result.push(zone as FieldZone);\n                });\n            } else if (fieldZone === \"EMZ\") {\n                for (let i = 0; i < 2; ++i) {\n                    const data = field.extraDeck[i] || field.extraDeck[i];\n                    const zone = `EMZ-${i + 1}`;\n                    if (!data) result.push(zone as FieldZone);\n                }\n            } else if (fieldZone === \"F\") {\n                if (field.fieldZone) result.push(\"F\");\n            }\n        }\n\n        return result;\n    }\n}","import { Card, FieldZone } from \"../types/types\";\nimport { YGOCore } from \"./YGOCore\";\nimport { YGOGameUtils } from \"./YGOGameUtils\";\n\nexport class YGOReplayUtils {\n    static createReplayData(ygo: YGOCore) {\n        const players = ygo.props.players.map((playerData, playerIndex) => {\n            return {\n                name: playerData.name,\n                deck: playerData.mainDeck.map(c => c.id),\n                mainDeckOrder: ygo.getField(playerIndex).initialMainDeckOrder,\n                extraDeck: playerData.mainDeck.map(c => c.id),\n            }\n        });\n\n        const commands = ygo.commands.map(cmd => cmd.toJSON());\n\n        const endField: any = [];\n\n        for (let playerIndex = 0; playerIndex < ygo.state.fields.length; ++playerIndex) {\n            const playerEndField: any = [];\n            const field = ygo.getField(playerIndex);\n\n            for (let i = 0; i < field.monsterZone.length; ++i) {\n                if (field.monsterZone[i]) {\n                    const card = field.monsterZone[i]!;\n                    const zone = YGOGameUtils.createZone(\"M\", playerIndex, i + 1);\n                    playerEndField.push(this.getMonsterCardInfo(card, zone));\n                }\n            }\n\n            for (let i = 0; i < field.spellTrapZone.length; ++i) {\n                if (field.spellTrapZone[i]) {\n                    const card = field.spellTrapZone[i]!;\n                    const zone = YGOGameUtils.createZone(\"S\", playerIndex, i + 1);\n                    playerEndField.push({ id: card.id, zone });\n                }\n            }\n\n            for (let i = 0; i < field.extraMonsterZone.length; ++i) {\n                if (field.extraMonsterZone[i]) {\n                    const card = field.extraMonsterZone[i]!;\n                    const zone = YGOGameUtils.createZone(\"EMZ\", playerIndex, i + 1);\n                    playerEndField.push(this.getMonsterCardInfo(card, zone));\n                }\n            }\n\n            for (let i = 0; i < field.graveyard.length; ++i) {\n                const card = field.graveyard[i];\n                const zone = YGOGameUtils.createZone(\"GY\", playerIndex);\n                playerEndField.push({ id: card.id, zone });\n            }\n\n            for (let i = 0; i < field.banishedZone.length; ++i) {\n                const card = field.banishedZone[i];\n                const zone = YGOGameUtils.createZone(\"B\", playerIndex);\n                const result: any = { id: card.id, zone };\n\n                if (YGOGameUtils.isFaceDown(card)) {\n                    result.position = \"facedown\"\n                }\n\n                playerEndField.push(result);\n            }\n\n            endField.push(playerEndField);\n        }\n\n        // todo get end field etc..\n        return {\n            players,\n            commands,\n            endField\n        }\n    }\n\n    private static getMonsterCardInfo(card: Card, zone: FieldZone): any {\n        const result: any = {\n            id: card.id,\n            zone\n        }\n\n        if (card.atk !== card.currentAtk) {\n            result.atk = card.currentAtk;\n        }\n\n        if (card.def !== card.def) {\n            result.atk = card.currentAtk;\n        }\n\n        if (card.position !== \"faceup-attack\") {\n            result.position = card.position;\n        }\n\n        if (card.materials.length > 0) {\n            result.materials = card.materials.map(materialCard => materialCard.id);\n        }\n\n        return result;\n    }\n}","import { GetCommandByClassName, Commands as YGOCommands } from \"../commands\";\nimport { Command } from \"../types/commands\";\nimport { PlayerField, YGOProps } from \"../types/types\";\nimport { EventBus } from \"../utils/event-bus\";\nimport { YGODuelLog } from \"./YGODuelLog\";\nimport { YGOGameState } from \"./YGOGameState\";\nimport { YGOReplayUtils } from \"./YGOReplayUtils\";\n\nexport class YGOCore {\n    // private\n    private commandId: number;\n    // public\n    public props: YGOProps;\n    public state: YGOGameState;\n    public commands: Command[];\n    public commandIndex: number = -1;\n    public duelLog: YGODuelLog;\n    public events: EventBus<any>;\n\n    constructor(props: YGOProps) {\n        this.props = props;\n        this.state = new YGOGameState(props);\n        this.duelLog = new YGODuelLog();\n        this.events = new EventBus();\n        this.commands = this.createYGOCommands(props.commands);\n        this.commandId = 0;\n    }\n\n    start() {\n        if (this.commands.length === 0) {\n            this.props.players.forEach((_, player) => {\n                const field = this.getField(player);\n                const numberOfCards = field.initialHandSize;\n                if (numberOfCards > 0 && field.hand.length === 0) {\n                    this.exec(new YGOCommands.DrawFromDeckCommand({\n                        player,\n                        numberOfCards\n                    }));\n                }\n            });\n        }\n    }\n\n    exec(command: Command): Command {\n        if (this.hasNextCommand()) {\n            this.commands.splice(this.commandIndex + 1, this.commands.length - this.commandIndex);\n        }\n        this.commandIndex = this.commands.length;\n        this.commands.push(command);\n        command.init(this);\n        command.exec();\n        return command;\n    }\n\n    peek(): Command | null {\n        return this.commands.length > 0 ? this.commands[this.commands.length - 1] : null;\n    }\n\n    redo(): Command | null {\n        if (!this.hasNextCommand()) return null;\n        this.commandIndex++;\n        const cmdToRedo = this.commands[this.commandIndex];\n        cmdToRedo.exec();\n\n        this.duelLog.onLogsUpdated();\n\n        return cmdToRedo;\n    }\n\n    undo(): Command | null {\n        if (!this.hasPrevCommand()) return null;\n\n        const cmdToUndo = this.commands[this.commandIndex];\n\n        this.duelLog.removeCommand(cmdToUndo);\n        cmdToUndo.undo();\n        this.commandIndex--;\n        this.duelLog.onLogsUpdated();\n\n        return cmdToUndo;\n    }\n\n    goToCommand(command: Command): boolean {\n\n        const commandIndex = this.commands.findIndex(c => c === command);\n\n        if (commandIndex === -1) return false;\n\n        if (commandIndex === this.commandIndex) return true;\n\n        if (commandIndex > this.commandIndex) {\n            while (this.commandIndex !== commandIndex && this.hasNextCommand()) {\n                this.redo();\n            }\n            return true;\n        } else {\n            while (this.commandIndex !== commandIndex && this.hasPrevCommand()) {\n                this.undo();\n            }\n            return true;\n        }\n    }\n\n    hasNextCommand() {\n        return this.commands.length - 1 > this.commandIndex;\n    }\n\n    hasPrevCommand() {\n        return this.commandIndex >= 0;\n    }\n\n    getNextCommandId() {\n        return ++this.commandId;\n    }\n\n    getReplayData() {\n\n        while (this.hasNextCommand()) {\n            this.redo();\n        }\n\n        return YGOReplayUtils.createReplayData(this);\n    }\n\n    getField(player: number): PlayerField {\n        return this.state.fields[player];\n    }\n\n    private createYGOCommands(commands?: any[]) {\n        if (Array.isArray(commands)) {\n            const loadedCommands = commands.map(cmd => {\n                const CommandClass = GetCommandByClassName(cmd.type);\n\n                if (!CommandClass) throw new Error(`Command \"${cmd.type}\" dont exists!`);\n\n                const command = new (CommandClass as any)(cmd.data)\n                command.init(this);\n                return command;\n            });\n            return loadedCommands;\n        }\n        return [];\n    }\n}","import { Commands } from './commands';\n\nexport * from './game/YGOCore';\nexport * from './game/YGODuelLog';\nexport * from './game/YGOGameUtils';\nexport * from './types/duel-events';\n\nexport const YGOCommands = Commands;"],"names":["BaseCommand","constructor","this","commandId","parent","init","ygo","YGO","getNextCommandId","getCommandId","_a","undefined","execChildCommand","command","exec","undoChildCommand","undo","undoMultipleChildCommand","commands","i","length","execMultipleChildCommand","isValid","toJSON","self","data","type","name","YGODuelEvents","CardBaseType","LogType","ActivateCardCommand","super","card","state","getCardById","id","originZone","zone","removeCard","setCard","console","log","prevPosition","position","duelLog","dispatch","player","Activate","YGOGameUtils","isLinkMonster","typeline","includes","isXYZMonter","isPendulumCard","frameType","isFaceUp","isFaceDown","isSpellTrap","isSpell","isTrap","startsWith","isDefense","isAttack","hasLinkMonstersInField","field","monsterZone","some","extraMonsterZone","hasXyzMonstersInField","getPlayerIndexFromZone","createZone","getZoneData","args","split","playerIndex","zoneId","zoneIndex","Number","endsWith","substring","getCardBaseType","EffectMonster","Spell","RitualMonster","Trap","FusionMonster","SynchroMonster","XYZMonster","LinkMonster","NormalMonster","getCardsBaseType","cards","map","c","toSortedCards","sortCards","cardsToSort","cardsWeights","j","shuffleCards","positions","Array","index","Math","floor","random","temp","YGOUtils","parseMainDeck","mainDeck","parseCard","isMainDeckCard","parseExtraDeck","extraDeck","extra","owner","originalOwner","materials","getCardsInGame","fields","Map","has","set","getOverlayZone","initializePlayersFields","props","shuffleDecks","options","cardIndex","lp","hand","initialHandSize","initialMainDeckOrder","spellTrapZone","fieldZone","graveyard","banishedZone","players","_","forEach","mainDeckOrder","swapIndex","getFieldsAsString","push","field1","getField","field2","join","_b","MoveCardCommand","materialsToGY","sendMaterialsToGy","overlayZone","material","SendToGY","reason","moveCard","BanishCommand","banishCommand","DestroyCardCommand","moveCardCommand","DrawFromDeckCommand","numberOfCards","pop","DrawCardFromDeck","newCards","reverse","cardInHandIndex","findIndex","splice","RevealCommand","Reveal","FieldSpellCommand","reveal","SendCardToGYCommand","LinkSummonCommand","LinkSummon","MillFromDeckCommand","max","min","NormalSummonCommand","SetCardCommand","SetMonsterCommand","ShuffleDeckCommand","cardPositions","Shuffle","SpecialSummonCommand","ToDeckCommand","getCommandType","isTopCard","getDeckIndex","deckIndex","shuffle","ToExtraDeckCommand","ToHandCommand","handIndex","TributeSetCommand","tributes","cmd","TributeSummonCommand","XYZAttachMaterialCommand","getCardFromZone","materialCardReference","XYZSummon","indexOf","XYZDetachMaterialCommand","materialIndex","XYZDetachMaterial","XYZSummonCommand","XYZMaterialsMove","XYZOverlay","Commands","COMMANDS_BY_NAME","EventBus","events","on","event","listener","get","listeners","off","filter","l","clear","delete","clearAll","YGODuelLog","logs","onLogsUpdated","peek","peekCommand","removeCommand","YGOGameState","cardsInGame","find","Error","moveCardById","cardId","isPendulum","unshift","weight","weight2","gyIndex","gy","banishZone","getCardData","shuffleDeck","deck","getAvailableZones","fieldZones","result","YGOReplayUtils","createReplayData","playerData","endField","playerEndField","getMonsterCardInfo","atk","currentAtk","def","materialCard","YGOCore","commandIndex","createYGOCommands","start","YGOCommands","hasNextCommand","redo","cmdToRedo","hasPrevCommand","cmdToUndo","goToCommand","getReplayData","isArray","CommandClass","commandClassName"],"mappings":"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"}